<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <!-- Enable responsiveness on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
      
        <meta name="description" content="算法" />
        <meta property="og:description" content="算法" />
        <meta property="twitter:description" content="算法" />
      
    

    <!-- Title -->
    
      
    
    <title>
    
    蒙特卡洛树搜索
    
</title>

    <!-- Additional Facebook Meta Tags -->
    <meta property="og:site_name" content="" />
    <meta
      property="og:url"
      content="https:&#x2F;&#x2F;flamintune.github.io&#x2F;monte-carlo&#x2F;"
    />
    <meta
      property="og:type"
      content="article"
    />
    <meta property="og:title" content="蒙特卡洛树搜索" />

    <!-- Additional Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      property="twitter:url"
      content="https:&#x2F;&#x2F;flamintune.github.io&#x2F;monte-carlo&#x2F;"
    />
    <meta name="twitter:title" content="蒙特卡洛树搜索" />

    <!-- Cover images -->
    
    

    <meta
      property="og:image"
      content="https:&#x2F;&#x2F;flamintune.github.io&#x2F;icons&#x2F;favicon&#x2F;web-app-manifest-512x512.png"
    />

    <meta
      name="twitter:image"
      content="https:&#x2F;&#x2F;flamintune.github.io&#x2F;icons&#x2F;favicon&#x2F;web-app-manifest-512x512.png"
    />



    <!-- Favicons -->
    
    <link
      rel="icon"
      type="image/png"
      href="https:&#x2F;&#x2F;flamintune.github.io/icons/favicon/favicon-96x96.png"
      sizes="96x96"
    />
    <link
      rel="icon"
      type="image/svg+xml"
      href="https:&#x2F;&#x2F;flamintune.github.io/icons/favicon/favicon.svg"
    />
    <link
      rel="shortcut icon"
      href="https:&#x2F;&#x2F;flamintune.github.io/icons/favicon/favicon.ico"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="https:&#x2F;&#x2F;flamintune.github.io/icons/favicon/apple-touch-icon.png"
    />
    <meta name="apple-mobile-web-app-title" content="蒙特卡洛树搜索" />
    <link
      rel="manifest"
      href="https:&#x2F;&#x2F;flamintune.github.io/icons/favicon/site.webmanifest"
    />
    

    <!-- RSS Feed -->
    

    <!-- Load Styles -->
    
      <link
        rel="stylesheet"
        href="https://flamintune.github.io/site.css"
      />
    

    <!-- Load Fonts -->
    

  






  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
  
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
  



<!-- Forcing Font -->
<style>
body {
  font-family:
    "JetBrains Mono", Menlo, Monaco, Lucida Console, Liberation Mono,
    DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New,
    monospace, serif !important;
}
</style>


    <!-- Pass Theme Preference as Data Attribute -->
    <script src="https://flamintune.github.io/js/init-theme.js"></script>

    <!-- Reference return to click position script -->
    <script defer src="https://flamintune.github.io/js/reference-return.js"></script>

    <!-- Additional scripts -->
    
      
      
        <script src="https://flamintune.github.io/js/toggle-theme.js"></script>
      
      

      
    
  </head>

  <!-- Body element (contents of the page) -->
  <body class="hack main container">
    
  
    
    
      
  
  <section class="nav-header">
    <nav
      itemscope
      itemtype="http://schema.org/SiteNavigationElement"
      class="navbar"
    >
      <section class="nav-links">
        
        <a
          itemprop="url"
          class=""
          href="https://flamintune.github.io"
        >
          <span itemprop="name">Home</span>
        </a>
        
        <a
          itemprop="url"
          class=""
          href="https://flamintune.github.io/categories"
        >
          <span itemprop="name">Categories</span>
        </a>
        
        <a
          itemprop="url"
          class=""
          href="https://flamintune.github.io/tags"
        >
          <span itemprop="name">Tags</span>
        </a>
        
      </section>
    </nav>
    <aside class="user-actions-container">
       
      <a id="dark-mode-toggle" href="#">
        <img
          src="https://flamintune.github.io/icons/sun.svg"
          id="sun-icon"
          style="filter: invert(1)"
          alt="Light mode"
        />
        <img
          src="https://flamintune.github.io/icons/moon.svg"
          id="moon-icon"
          alt="Dark mode"
        />
      </a>
        
      <a
        href="https:&#x2F;&#x2F;github.com&#x2F;flamintune"
        class="feed-icon"
        rel="noopener noreferrer"
      >
        <img
          src="https://flamintune.github.io/icons/github.svg"
          id="github-icon"
          alt="GitHub"
          class="social-icon"
        />
      </a>
      
    </aside>
  </section>
  

    


    <main>
      

<article itemscope itemtype="http://schema.org/BlogPosting">
    <header>
        <h1 itemprop="headline">蒙特卡洛树搜索</h1>
        <data class="muted">
    <svg class="icon i-clock" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <circle cx="16" cy="16" r="14"/>
        <path d="M16 8 L16 16 20 20"/>
    </svg>
    <data>12 minute read</data>
    <svg class="icon i-edit" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <path d="M30 7 L25 2 5 22 3 29 10 27 Z M21 6 L26 11 Z M5 22 L10 27 Z"/>
    </svg>

    Published: 2025-11-05
</data>
    </header>

    <article itemprop="articleBody">
        
            <!-- If no summary separate from content, just render content -->
            <h2 id="meng-te-qia-luo-shu-sou-suo">蒙特卡洛树搜索</h2>
<p>在看 <a href="https://openreview.net/forum?id=z5uVAKwmjf">AFlow</a> 这篇论文的时候, 发现里面有提到蒙特卡洛树搜索 (MCTS) 这个算法。我对这个算法完全是一无所知，只是知道它是一种搜索算法，和其他搜索算法（遗传算法，巴拉巴拉什么的一样），都是寻找特定空间的最优解问题。</p>
<p>在和 Gemini 聊了很多轮后，我也是对 MCTS 这个算法有了一定的了解。它的基本流程可以简单地概括为利用+探索，拓展，模拟，反向传播。下面简单记录一下我对这个算法的理解，也顺带在输出的过程中，发现那些还有困惑的地方。</p>
<h2 id="ta-suo-mian-lin-de-chang-jing-wei-he-xu-yao-mcts">它所面临的场景：为何需要 MCTS？</h2>
<p>在聊 MCTS 怎么做之前，我们得先聊聊<strong>为什么</strong>需要它。</p>
<p>传统的游戏 AI 算法，比如 Minimax（极小化极大算法），本质上是一种 DFS（深度优先搜索）。它试图暴力搜索整棵游戏树，评估所有可能的未来，然后找到一个绝对最优解。</p>
<p>对于五子棋，这或许还行。但对于围棋（Go）呢？</p>
<p>围棋的游戏树复杂度（所有可能的合法走法）比宇宙中的原子总数还多。你不可能算完它。</p>
<p>这就是 MCTS 要解决的核心问题：当搜索空间（所有可能的未来）过于庞大，以至于无法暴力算完时，你该如何做出一个足够好的甚至是最优的决策？</p>
<p>MCTS 的答案是：我放弃算尽一切，转而使用智慧的采样。我不会均匀地搜索所有路径，而是会把我的计算资源集中在那些看起来有前途的路径上。它用大数定律的统计学思想，来代替确定性的计算。只要我足够多的迭代，最终就能逐渐收敛到一个近似最优的解。</p>
<p>AlphaGo 成功的背后也有 MCTS 的身影。</p>
<h2 id="suan-fa-liu-cheng">算法流程</h2>
<p>MCTS 的算法流程是一个不断迭代的循环，大致分为四步</p>
<ol>
<li>选择 (Selection)：从根节点出发，根据一个评分公式，一路向下，找到一个最值得深入的路径，直到抵达我们<strong>已知树的边界</strong>。</li>
<li>拓展 (Expansion)：在<strong>边界</strong>处，添加一个新的、未访问过的子节点。</li>
<li>模拟 (Simulation)：从这个新节点开始，随机快进下到底，看这一局是赢是输。即快速模拟当前节点的希望。</li>
<li>反向传播：将赢/输的结果，传回给路径上的所有父节点，更新它们的统计数据。</li>
</ol>
<p>这个循环会重复成千上万次（比如在 1 秒钟内）。时间到！停止循环。查看根节点的所有子节点，选择一个最稳健的作为最终走法。</p>
<h3 id="xuan-ze">选择</h3>
<p>这是 MCTS 最核心、最巧妙的一步。它解决的问题：我应该在哪个已知的分支上投入更多的‘思考’？</p>
<p>它用一个 UCT(Upper Confidence Bound 1 applied to Trees，树的置信上限)公式完美地平衡了两个概念：</p>
<ul>
<li>利用 (Exploitation)：选择那个当前看起来胜率最高的走法。</li>
<li>探索 (Exploration)：选择那个我还不太了解，但不确定性很高的走法（万一它是奇招呢？）。</li>
</ul>
<blockquote>
<p>写到这里的时候，我想起了之前学习强化学习，也有类似的利用x探索的策略，比如 Q learning 中的 epsilon-greedy 策略。</p>
</blockquote>
<p><strong>UCT 分数 = (w_i / n_i) + C * sqrt(ln(N) / n_i)</strong></p>
<p>我们来拆解它：</p>
<ul>
<li>w_i / n_i (平均胜率)：这就是利用。w_i 是这个节点赢的次数，n_i 是它总共被访问的次数。这个值越高，说明它历史战绩越好。</li>
<li>C * sqrt(ln(N) / n_i) (探索奖励)：这就是探索。</li>
<li>N 是父节点被访问的总次数。</li>
<li>n_i 还是这个子节点被访问的次数。</li>
<li>关键： 如果一个子节点 n_i 很小（我们很少试它），1 / n_i 就会很大，导致整个探索奖励飙升。这会强制算法去将资源倾斜到这个冷门选项。</li>
</ul>
<p>选择阶段的完整流程是：</p>
<ul>
<li>从根节点 R 开始。查看其所有已被访问过的子节点（A, B, C）。</li>
<li>使用 UCT 公式计算 A, B, C 的分数。</li>
<li>选择分数最高的那个（比如 B），跳到 B。</li>
<li>重复这个过程：在 B 节点，再用 UCT 公式选出它分数最高的子节点（D, E, F...），再跳过去...</li>
</ul>
<p>这个过程何时停止？这个UCT 跳跃会一直持续，直到我们第一次撞到一个节点 P，它满足：</p>
<ul>
<li>P 本身是被访问过的。</li>
<li>P 至少有一个子节点是未被访问的（n_child = 0）。</li>
</ul>
<p>这个 P 节点，就是我们这条最值得路径的终点，也是我们已知树的边界。选择阶段结束， 我们把 P 节点交给下一步拓展。</p>
<h3 id="tuo-zhan">拓展</h3>
<p>因为选择阶段，我们已经选出了树的边界了，所以我们需要拓展这个边界。</p>
<p>拓展的过程很简单：在 P 节点，随机选择一个未被访问过的子节点（比如 I），并添加到 MCTS 树中。P 节点必然有一个未被访问的子节点，因为我们在选择阶段，选出来的 P 至少有一个子节点是未被访问的。</p>
<p>这个新节点 I 的初始数据是：w_I = 0，n_I = 0。现在，I 是我们这轮循环的主角。</p>
<h3 id="mo-ni">模拟</h3>
<p>我们刚创建了新节点 I，对它一无所知（0/0 没法用 UCT）。我们该如何快速知道它是好棋还是臭棋？</p>
<p>答案是：随机快进（也叫 Playout 或 Rollout）。</p>
<ol>
<li>从 I 节点代表的局面开始。</li>
<li>算法随机地帮我方走一步。</li>
<li>算法随机地帮对手走一步。</li>
<li>重复这个随机互下的过程，直到游戏分出胜负（比如黑棋赢了）。</li>
<li>记录下这个结果（比如 +1 代表赢，0 代表输）。</li>
</ol>
<p>这就像石头剪刀布一样，单次看运气成分很大，但根据「大数定律」，只要我们模拟的次数足够多，这个粗略的估计就会非常接近真实胜率。</p>
<h3 id="fan-xiang-chuan-bo">反向传播</h3>
<p>我们拿到了上一步模拟的胜负结果（比如 +1）。</p>
<p>这一步的工作，就是把这个结果递归地更新回路径上的所有祖先节点。</p>
<ol>
<li>更新 I：w_I 变为 1，n_I 变为 1。</li>
<li>更新 I 的父亲 P：w_P (总胜场) +1，n_P (总访问) +1。</li>
<li>更新 P 的父亲...：w +1, n +1。</li>
<li>一直更新到根节点 R：w_R +1, n_R +1。</li>
</ol>
<p>至此，一个完整的 MCTS 循环结束。算法会立即从根节点 R 重新开始下一次循环。</p>
<h3 id="zui-zhong-jue-ce-shi-jian-dao-liao">最终决策：时间到了！</h3>
<p>当 1 秒钟的思考时间用完，MCTS 循环停止。算法必须在棋盘上落子了。</p>
<p>它会回到根节点 R，查看它的所有子节点（A, B, C...），然后做出最终选择。</p>
<p>标准是什么？不是胜率最高，甚至也不是赢的次数最多，而是<strong>访问次数 n 最高</strong>的那个节点。</p>
<p>为什么？</p>
<p>为什么不是胜率 (w/n)？ * 节点 A: w=1, n=1 (胜率 100%)</p>
<ul>
<li>节点 B: w=900, n=1000 (胜率 90%)</li>
<li>胜率会选 A，但 A 只是运气好的小样本事件，B 才是被 1000 次访问验证过的好棋。</li>
</ul>
<p>为什么不是胜场 (w)？</p>
<ul>
<li>节点 A: w=100, n=1000 (胜率 10%)</li>
<li>节点 B: w=90, n=100 (胜率 90%)</li>
<li>胜场会选 A，但 A 其实是被访问了 1000 次才赢 100 次的臭棋。</li>
</ul>
<p>n (访问次数) 是最稳健的指标。一个节点的 n 很高，说明 MCTS 的 UCT 公式（在利用和探索的反复权衡中）最终决定将最多的计算资源投入给它。它是那个被算法千锤百炼后选出来的、最值得信赖的走法。</p>
<h2 id="alphago-zhong-de-mcts-shen-jing-wang-luo-yu-zuo-bi-qi">AlphaGo 中的 MCTS：神经网络与作弊器</h2>
<p>MCTS 算法很强，但它的模拟阶段（随机快进）又慢又蠢。如果能优化这个阶段，效率会大大提升。
AlphaGo 的做法就是用深度学习来替换MCTS 的短板。它不是只用一个作弊器，而是用了<strong>两个</strong>：</p>
<ol>
<li>
<p><strong>价值网络 (Value Network)</strong>：</p>
<ul>
<li><strong>替换了模拟 (第 3 步)</strong>。</li>
<li>MCTS 不再需要随机快进到底了。当它拓展出一个新节点 <code>I</code> 时，它直接把 <code>I</code> 的局面丢给价值网络。</li>
<li>这个网络会<strong>瞬间</strong>给出一个胜率估计（比如 <code>0.73</code>）。这个结果比随机快进1000 次得到的 <code>+1</code> 或 <code>0</code> 要<strong>准确得多</strong>。</li>
</ul>
</li>
<li>
<p><strong>策略网络 (Policy Network)</strong>：</p>
<ul>
<li><strong>优化了拓展 (第 2 步)</strong>。</li>
<li>MCTS 在拓展节点 <code>P</code> 时，不再是随机挑一个子节点了。</li>
<li>它会把 <code>P</code> 局面丢给策略网络，这个网络会返回一个概率分布，告诉你：<code>P</code> 的 10 个下一步里，走 <code>I</code> 的可能性是 50%，走 <code>J</code> 的可能性是 30%...</li>
<li>MCTS 会<strong>优先</strong>去拓展那些策略网络推荐的、看起来更像好棋的节点。</li>
</ul>
</li>
</ol>
<p>AlphaGo = MCTS (作为总指挥框架) + 两个神经网络 (作为专家顾问)。
它把 MCTS 的统计学智慧和 深度学习的模式识别直觉完美地结合在了一起。</p>
<h2 id="zong-jie">总结</h2>
<p>等几天后，再回过头来复习看下，看能忘多少...</p>

        
    </article>

    <!-- Comment section -->
    
      
    


    <!-- Page footer -->
    
    <footer>
        <hr>
        <p>
            
            
                
                in <a href="https://flamintune.github.io/categories/algorithm/">algorithm</a>
            
            
                and
                tagged
                
                    <a href="https://flamintune.github.io/tags/algorithm/">algorithm</a>
                    
                
            
        </p>

        <!-- Revision history (optional) -->
        
          
            
              
            
          
        

        
        
    </footer>


</article>


    </main>
    

  </body>
</html>
